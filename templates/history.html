{% extends "base.html" %}
{% block content %}
<style>

/* Page header */
.page-header { margin-bottom: 2rem; animation: fadeUp 0.5s ease both; }
.page-header-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; flex-wrap: wrap; }
.page-header h1 { font-family: var(--font-display); font-size: clamp(1.75rem,3vw,2.5rem); font-weight: 400; letter-spacing: -0.02em; color: var(--ink); margin-bottom: 0.375rem; }
.page-header h1 em { font-style: italic; color: var(--ink-3); }
.page-header p { font-size: 14px; color: var(--ink-3); }

/* Stat strip */
.stat-strip {
    display: flex; gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-xs);
    animation: fadeUp 0.5s 0.05s ease both;
}
.stat-item {
    flex: 1; padding: 1rem 1.25rem;
    background: var(--surface);
    transition: background 0.15s;
}
.stat-item:hover { background: var(--bg-subtle); }
.stat-val { font-family: var(--font-display); font-size: 1.75rem; font-weight: 400; color: var(--ink); letter-spacing: -0.02em; line-height: 1; margin-bottom: 4px; }
.stat-label { font-size: 11px; font-weight: 600; color: var(--ink-3); text-transform: uppercase; letter-spacing: 0.05em; }

/* Section toolbar */
.section-toolbar {
    display: flex; align-items: center; justify-content: space-between; gap: 1rem;
    margin-bottom: 1rem; flex-wrap: wrap;
    animation: fadeUp 0.5s 0.08s ease both;
}
.section-title { font-size: 13px; font-weight: 700; color: var(--ink-2); text-transform: uppercase; letter-spacing: 0.05em; display: flex; align-items: center; gap: 8px; }
.section-count { font-size: 11px; font-weight: 600; background: var(--bg-subtle); color: var(--ink-3); border: 1px solid var(--border); border-radius: 20px; padding: 2px 8px; }

/* Files grid */
.files-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 12px;
    animation: fadeUp 0.5s 0.1s ease both;
}

.file-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 1.25rem;
    display: flex; flex-direction: column; gap: 12px;
    text-decoration: none; color: inherit;
    transition: all 0.18s;
    box-shadow: var(--shadow-xs);
    position: relative; overflow: hidden;
}
.file-card::before {
    content: '';
    position: absolute; left: 0; top: 0; bottom: 0;
    width: 3px; background: transparent;
    transition: background 0.18s;
    border-radius: 3px 0 0 3px;
}
.file-card:hover { border-color: var(--border-2); box-shadow: var(--shadow-md); transform: translateY(-2px); }
.file-card:hover::before { background: var(--coral); }

.fc-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
.fc-icon {
    width: 40px; height: 40px; border-radius: var(--radius);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.fc-icon.md { background: var(--navy-light); }
.fc-icon.img { background: var(--teal-light); }
.fc-icon.other { background: var(--bg-subtle); }
.fc-icon svg { width: 18px; height: 18px; fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
.fc-icon.md svg { stroke: var(--navy); }
.fc-icon.img svg { stroke: var(--teal); }
.fc-icon.other svg { stroke: var(--ink-3); }

.fc-badge { font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 4px; letter-spacing: 0.05em; text-transform: uppercase; }
.fc-badge.md { background: var(--navy-light); color: var(--navy); }
.fc-badge.img { background: var(--teal-light); color: var(--teal); }
.fc-badge.other { background: var(--bg-subtle); color: var(--ink-3); border: 1px solid var(--border); }

.fc-name { font-size: 13px; font-weight: 600; color: var(--ink); line-height: 1.4; word-break: break-all; }
.fc-action { font-size: 11px; font-weight: 600; color: var(--ink-3); display: flex; align-items: center; gap: 4px; transition: color 0.15s; }
.file-card:hover .fc-action { color: var(--coral); }
.fc-action svg { width: 11px; height: 11px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

/* Empty state */
.empty-state {
    text-align: center; padding: 5rem 2rem;
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xs); animation: fadeUp 0.5s 0.1s ease both;
}
.empty-icon-wrap {
    width: 64px; height: 64px; border-radius: 50%;
    background: var(--bg-subtle); border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 1.25rem; box-shadow: var(--shadow-sm);
}
.empty-icon-wrap svg { width: 26px; height: 26px; stroke: var(--ink-4); fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
.empty-title { font-family: var(--font-display); font-size: 1.35rem; font-weight: 400; color: var(--ink); margin-bottom: 0.5rem; }
.empty-body { font-size: 14px; color: var(--ink-3); max-width: 340px; margin: 0 auto 1.5rem; line-height: 1.6; }

.cta-btn {
    display: inline-flex; align-items: center; gap: 8px;
    font-size: 14px; font-weight: 600; color: white;
    background: var(--coral); border: none; border-radius: var(--radius);
    padding: 0.75rem 1.5rem; text-decoration: none; cursor: pointer;
    transition: all 0.18s; box-shadow: 0 2px 8px rgba(232,76,43,0.25);
}
.cta-btn:hover { background: #D63D1E; box-shadow: 0 4px 16px rgba(232,76,43,0.35); transform: translateY(-1px); }
.cta-btn svg { width: 15px; height: 15px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

@keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

</style>

<!-- Page header -->
<div class="page-header">
    <div class="page-header-row">
        <div>
            <h1>Run <em>History</em></h1>
            <p>Generated output files from your AI Data Engineer pipeline runs</p>
        </div>
        <a href="/" class="cta-btn">
            <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Run
        </a>
    </div>
</div>

<!-- Stat strip -->
<div class="stat-strip">
    <div class="stat-item">
        <div class="stat-val">{{ files|length if files else 0 }}</div>
        <div class="stat-label">Total Files</div>
    </div>
    <div class="stat-item">
        <div class="stat-val">{{ files | selectattr('__contains__', 'equalto', '.md') | list | length if files else 0 }}</div>
        <div class="stat-label">Documents</div>
    </div>
    <div class="stat-item">
        <div class="stat-val">{{ files | selectattr('__contains__', 'equalto', '.png') | list | length if files else 0 }}</div>
        <div class="stat-label">Diagrams</div>
    </div>
    <div class="stat-item">
        <div class="stat-val">{{ files | selectattr('__contains__', 'equalto', 'chart') | list | length if files else 0 }}</div>
        <div class="stat-label">Charts</div>
    </div>
</div>

{% if files %}

<div class="section-toolbar">
    <div class="section-title">
        Output Files
        <span class="section-count">{{ files|length }}</span>
    </div>
</div>

<div class="files-grid">
    {% for file in files %}
    {% set ext = file.rsplit('.', 1)[-1].lower() if '.' in file else 'other' %}
    {% set is_img = ext in ['png', 'jpg', 'jpeg'] %}
    {% set is_md  = ext == 'md' %}
    <a href="/view/{{ file }}" class="file-card" style="animation:fadeUp 0.4s {{ loop.index * 0.04 }}s ease both;opacity:0;">
        <div class="fc-top">
            <div class="fc-icon {% if is_md %}md{% elif is_img %}img{% else %}other{% endif %}">
                {% if is_img %}
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                {% elif is_md %}
                <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                {% else %}
                <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                {% endif %}
            </div>
            <span class="fc-badge {% if is_md %}md{% elif is_img %}img{% else %}other{% endif %}">.{{ ext }}</span>
        </div>
        <div class="fc-name">{{ file }}</div>
        <div class="fc-action">
            Open file
            <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        </div>
    </a>
    {% endfor %}
</div>

{% else %}

<div class="empty-state">
    <div class="empty-icon-wrap">
        <svg viewBox="0 0 24 24"><path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
    </div>
    <div class="empty-title">No output files yet</div>
    <div class="empty-body">Run the AI Data Engineer pipeline to generate your first architecture blueprint. Results will appear here.</div>
    <a href="/" class="cta-btn">
        <svg viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        Start Your First Run
    </a>
</div>

{% endif %}

{% endblock %}